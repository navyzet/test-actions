name: Deploy to yandex and azure dev environment
on:
  workflow_run:
    workflows: ["Run tests"]
    branches: [main]
    types:
      - completed

env:
  BUILD_NUMBER: ${{ github.run_number }}

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Print github context
        env:
            GITHUB_CONTEXT: ${{ toJSON(github) }}
        run: echo "$GITHUB_CONTEXT"

  build-image:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Build image image:$BUILD_NUMBER"

  deploy-to-dev:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploy-to-dev image:$BUILD_NUMBER"
    needs: [build-image]

  deploy-to-yat:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploy-to-yat image:${{ github.run_number }}"
    needs: [build-image]